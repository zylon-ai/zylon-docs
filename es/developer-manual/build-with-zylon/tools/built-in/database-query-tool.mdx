---
title: "Herramienta de consulta a base de datos"
description: "Consulta una base de datos SQL desde lenguaje natural durante un mensaje."
---

Usa Database Query cuando quieres que el asistente responda preguntas a partir de una base de datos SQL. Proporcionas una conexión en `tool_context`.

## Requisitos previos

```bash
export API_TOKEN="YOUR_API_TOKEN"
```

Si aún no tienes un token, consulta [Gestión de tokens](/es/api-reference/token-management).

## Requisitos

- Tool spec: `{ "name": "database_query", "type": "database_query_v1" }`
- `tool_context`: al menos un `sql_database` con `connection_string`

## Solicitud y respuesta básicas

Este ejemplo valida la forma del request usando un connection string de ejemplo.

Para evitar un chequeo de conectividad durante la validación, establece `tool_choice.type` en `"none"`. Cuando vayas a ejecutar la herramienta, cambia `tool_choice.type` a `"auto"` (o fuerza la herramienta) y envía la request a `POST /messages`.

```bash
curl -X POST "https://{base_url}/gpt/v1/messages/validate" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "default",
    "max_tokens": 128,
    "messages": [
      { "role": "user", "content": "How many customers are in the database?" }
    ],
    "tools": [
      { "name": "database_query", "type": "database_query_v1" }
    ],
    "tool_choice": { "type": "none" },
    "tool_context": [
      {
        "type": "sql_database",
        "connection_string": "postgresql://readonly_user:readonly_pass@db.example.com:5432/app",
        "ssl": true
      }
    ]
  }'
```

Respuesta de ejemplo:

```json
{ "valid": true, "errors": null }
```

Para ejecutar la request, establece `tool_choice.type` en `"auto"` y envía el mismo body a `POST /messages`.

## Consejos de seguridad

- Usa un usuario de base de datos **solo lectura**.
- Restringe el acceso de red a la DB y rota credenciales.
- Limita esquemas/tablas expuestos siempre que sea posible.

